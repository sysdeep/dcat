# BinMap

хранение данных в бинарном формате

данные файлов хранятся в 1 таблице, а текстовые данные. - во второй

это необходимо для быстрого чтения заголовков

для адресации - создавать карту при загрузке - отсутствие жёсткой адресации позволит произвольно менять данные в памяти и сохранять их в произвольном порядке - что удобно при удалении. При загрузке создастся новая карта 


при открытии файла 
- читаем заголовок, загружаем его
- узнаём расположение и размер секции данных
- загружаем секцию данных в память
- распарсиваем секцию данных

- узнаём расположение и размер секции текста
- загружаем секцию текста в память



текстовая секция представляет из себя кучу, в которой находятся счётные строки. 
На каждую запись в куче есть ссылка в структуре данных файла.


 


```xml

<file>
	<file_header />
	<volume_header />
	<records>
		<record />
	</records>
	<text_heap>
		<calc_string />
	</text_heap>
</file>


```



|id|pid|...data...|



on load - читаем все записи(они одной длины, потому можно читать только необходимые данны) и строим карту

|id|pid|pos|



Плюсы:

- возможность удаления


Минусы:
- создание карты при загрузке



## Запись

- сформировать секцию статичных данных и динамических данных в памяти
- сформировать заголовок
- записать данные в файл 



## Сохранение изменений


- секция данных преобразуется в бинарный вид
- секция текста копируется в новую бинарную секцию(с применением изменений)
- пред. 2 операции должны бвть одновременными(для взаимной корректировки данных)
- формируется заголовок
- запись в файл




## Чтение

распаковываем таблицу файлов, они все сразу готовы

текстовые данные остаются в куче

при запросе определённых нод, они выбираются из готовых записей файлов, 
и дополняются текстовыми данными из кучи.

тем самым сводится к минимуму время доступа.








## Результаты

^ кол-во файлов ^ размер базы 	^ время распарсивания данных ^
| 313057	 	| 2.6 Mb 		| 0.8 с 					 |








